import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Keep plotting simple and compatible
plt.style.use("default")

train = pd.read_csv("train.csv")
test = pd.read_csv("test.csv")

print("Train shape:", train.shape)
print("Test shape:", test.shape)
print("Train columns:", list(train.columns))
print("\nFirst 5 rows:\n", train.head())

print("\nTrain info:")
train.info()
print("\nTrain describe:\n", train.describe(include='all'))

# Correlation heatmap (numeric columns only)
plt.figure(figsize=(8,6))
corr = train.select_dtypes(include=[np.number]).corr()
sns.heatmap(corr, annot=True, cmap="coolwarm")
plt.title("Correlation (numeric features)")
plt.show()

# Scatter example (safe)
if "hours_studied" in train.columns and "exam_score" in train.columns:
    plt.scatter(train["hours_studied"], train["exam_score"])
    plt.xlabel("Hours Studied")
    plt.ylabel("Exam Score")
    plt.title("hours_studied vs exam_score")
    plt.show()

# --- Basic cleaning ---
before_rows = len(train)
train = train.drop_duplicates()
print(f"Dropped duplicates: {before_rows} -> {len(train)}")

# Fill missing values for key numeric features (mean imputation)
for col in ["hours_studied", "sleep_hours", "attendance_rate", "prev_exam_score", "exam_score", "passed"]:
    if col in train.columns:
        if train[col].isna().any():
            train[col] = train[col].fillna(train[col].mean())

# Remove impossible attendance_rate values (keep 0..100)
if "attendance_rate" in train.columns:
    before = len(train)
    train = train[(train["attendance_rate"] >= 0) & (train["attendance_rate"] <= 100)]
    print(f"Filtered attendance_rate to [0,100]: {before} -> {len(train)}")

# --- Feature selection ---
features = ["hours_studied", "sleep_hours", "attendance_rate", "prev_exam_score"]
features = [c for c in features if c in train.columns]
if not features:
    raise ValueError("None of the expected feature columns were found in train.csv")

# Targets
if "exam_score" not in train.columns:
    raise ValueError("exam_score column not found in train.csv")

X_train = train[features].to_numpy(dtype=float)
y_train = train["exam_score"].to_numpy(dtype=float)

# --- Z-score normalization (fit on train only) ---
mean = X_train.mean(axis=0)
std = X_train.std(axis=0)
std[std == 0] = 1.0  # avoid divide-by-zero

X_train_norm = (X_train - mean) / std

# Apply SAME mean/std to test
X_test = test[features].to_numpy(dtype=float)
X_test_norm = (X_test - mean) / std

print("\nSelected features:", features)
print("X_train_norm shape:", X_train_norm.shape)
print("X_test_norm shape:", X_test_norm.shape)
